{% extends 'chat/main.html' %}

{% block content %}
<style>
#pendingQuizTable {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
  margin-left:auto;
  margin-right:auto;
  margin-top: 60px;
}

#pendingQuizTable td, #pendingQuizTable th {
  border: 1px solid #ddd;
  padding: 8px;
}

#pendingQuizTable tr:nth-child(even){background-color: #f2f2f2;}

.table_row:hover {background-color: #ddd;}

#pendingQuizTable th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}
</style>

<!--<section class="dashboard-counts no-padding-bottom">
    <div class="container-fluid">
      <div class="row bg-white has-shadow">
        <div class="col-xl-7 col-sm-8">

            <div class="container">
                <form role="form">
                    <div class="panel panel-primary setup-content step-1" id="step-1">
                        <div class="panel-heading">
                             <h3 class="panel-title">퀴즈 정답 관리</h3>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <div class="quiz_question">
                                    <label class="control-label">질문 : </label>
                                    <b id="question_value"></b><br>
                                </div>
                                <div class="quiz_examples">
                                    <label class="control-label">보기 : </label>
                                    <b id="example_value"></b><br><br>
                                </div>
                                <label class="control-label">정답 입력</label>
                                <input id="quiz_answer" maxlength="100" type="text" required="required" class="form-control"
                                       placeholder="정답 입력 ( 객관식은 번호입력 )" />
                                <button id="service_submit" class="btn btn-primary add-example-btn" type="button">정답 제출하기</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
      </div>
    </div>
</section>-->

<section class="dashboard-header no-padding-bottom">
<div class="container-fluid">
  <div class="row">
    <!-- Statistics -->
    <div class="statistics col-lg-8 col-12">
      <div class="statistic d-flex align-items-center bg-white has-shadow">
        <div class="container">
            <form role="form">
                <div class="panel panel-primary setup-content step-1" id="step-1">
                    <div class="panel-body">
                        <div class="form-group">
                            <div class="quiz_question">
                                <label class="control-label">질문 : </label>
                                <b id="question_value"></b><br>
                            </div>
                            <div class="quiz_examples">
                                <label class="control-label">보기 : </label>
                                <button id="example-button1" class="btn example-button" type="button"></button>
                                <button id="example-button2" class="btn example-button" type="button"></button>
                                <button id="example-button3" class="btn example-button" type="button"></button>
                                <button id="example-button4" class="btn example-button" type="button"></button>
                                <button id="example-button5" class="btn example-button" type="button"></button>
                                <button id="example-button6" class="btn example-button" type="button"></button>
                                <button id="example-button7" class="btn example-button" type="button"></button>
                                <button id="example-button8" class="btn example-button" type="button"></button>
                                <button id="example-button9" class="btn example-button" type="button"></button>
                                <button id="example-button10" class="btn example-button" type="button"></button>
                                <b id="example_value"></b><br><br>
                            </div>
                            <label class="control-label">정답 입력</label>
                            <input id="quiz_answer" maxlength="100" type="text" required="required" class="form-control"
                                   placeholder="정답 입력 ( ** 위의 보기를 선택하여 입력 권장 ** )" style="margin-bottom: 10"/>
                            <button id="service_submit" class="btn btn-primary add-example-btn" type="button">정답 제출하기</button>
                        </div>

                        <!--<button class="btn btn-success pull-right" type="button" id="service_submit">제출하기</button>-->
                    </div>
                </div>
            </form>
        </div>

      </div>
    </div>
  </div>
</div>
</section>


<!--
<table id="pendingQuizTable">
        <tr class="header">
            <th hidden="hidden">서비스 ID</th>
            <th>서비스 타입</th>
            <th>세부 타입</th>
            <th>프로그램</th>
            <th>서비스 요약</th>
            <th>퀴즈 질문</th>
            <th>퀴즈 보기</th>
            <th>날짜</th>
        </tr>
        {% for service in services %}
        <tr class="table_row">
            <td class="service_id" hidden="hidden">{{ service.service_id }}</td>
            <td>{{ service.get_service_type }}</td>
            <td>{{ service.get_detail_type }}</td>
            <td>{{ service.program_title }}</td>
            <td>{{ service.service_title }}</td>
            <td class="question">{{ service.get_question }}</td>
            <td class="examples">{{ service.get_examples }}</td>
            <td>{{ service.publish_date}}</td>
        </tr>
        {% endfor %}
</table>
-->
<section class="tables">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-10">

          <div class="card">
            <div class="card-header d-flex align-items-center">
              <h3 class="h4">정답 대기 리스트</h3>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                        <th hidden="hidden">서비스 ID</th>
                        <th hidden="hidden">서비스 타입</th>
                        <th>퀴즈 타입</th>
                        <th>프로그램</th>
                        <th>요약</th>
                        <th>질문</th>
                        <th>보기</th>
                        <th>날짜</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for service in services %}
                    <tr class="table_row">
                        <td class="service_id" hidden="hidden">{{ service.service_id }}</td>
                        <td hidden="hidden">{{ service.get_service_type }}</td>
                        <td>{{ service.get_detail_type }}</td>
                        <td>{{ service.program_title }}</td>
                        <td>{{ service.service_title }}</td>
                        <td class="question">{{ service.get_question }}</td>
                        <td class="examples">{{ service.get_examples }}</td>
                        <td>{{ service.publish_date}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>




<script>

    document.getElementById("action-title").innerHTML = "퀴즈 정답 관리"
    var all_buttons = $('.example-button')
    var example_buttons = [$('#example-button1'), $('#example-button2'), $('#example-button3'),
                    $('#example-button4'), $('#example-button5'), $('#example-button6'),
                    $('#example-button7'), $('#example-button8'), $('#example-button9'),
                    $('#example-button10')];

    all_buttons.hide();
    all_buttons.click( function() {
        var exist_answer = document.querySelector('#quiz_answer').value;
        if( exist_answer.length > 0){
            document.querySelector('#quiz_answer').value = exist_answer + "|" + $(this).text();
        }else{
            document.querySelector('#quiz_answer').value = $(this).text();
        }

    });

    var roomName = {{ room_name_json }};
    var service_id = "";

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/chat/' + roomName + '/');

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    $('.table_row').click(function(){
        all_buttons.hide();
        var question = $(this).find('.question').text();
        var examples = $(this).find('.examples').text();
        service_id = $(this).find('.service_id').text();
        document.getElementById("question_value").innerHTML = question;

        example_split = examples.split("|");
        for(var i = 0; i < example_split.length; i++){
            example_buttons[i].html(example_split[i]);
            example_buttons[i].show();
        }


        //document.getElementById("example_value").innerHTML = examples;
    })

    document.querySelector('#service_submit').onclick = function(e) {
        if (service_id == "") {
            return ;
        }
        var quiz_answer = document.querySelector('#quiz_answer').value;
        if (quiz_answer.length == 0) {
            return ;
        }
        chatSocket.send(JSON.stringify({
            'category': 'tv',
            'channel_name': roomName,
            'service_id': service_id,
            'service_type': "quiz_answer",
            'answer': quiz_answer,
        }));
        location.reload(true);

    };


</script>



{% endblock %}